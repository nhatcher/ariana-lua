<!DOCTYPE html>
<head>
<meta charset="utf-8">
</head>
<body>
  <div>
    <textarea id="edit" style="width: 800px; height: 480px;" onkeyup="text_changed();">
function Plot(g, xmin, xmax)
  local x = xmin;
  local N = 100;
  local step = (xmax - xmin)/N;
  for x=xmin, xmax, step do
    plot.set_point(x, g(x));
    x = x + step;
  end
end

function main()
  local function f(x)
    return tfunc.j0(x);
  end

  Plot(f, -5, 5)
end

main()
    </textarea>
    <div id="result" style="width: 800px; float: right"></div>
  </div>
</body>
<script type='text/javascript'>
    var Module = {
        // onRuntimeInitialized: text_changed,
        postRun: [
          text_changed
        ],
        // instantiateWasm: function(inports, callback) {

        // },
        print: function (text) {
            if (arguments.length > 1) {
                text = Array.prototype.slice.call(arguments).join(' ');
            }
            console.log(text);
    
            if(text != "emsc") {
                document.getElementById("result").innerHTML += "<br>\n" + text;
            }
        },
        printErr: function (text) {
            if (arguments.length > 1) {
                text = Array.prototype.slice.call(arguments).join(' ');
                console.error(text);
            }
        }
    };
    
    function text_changed() {
      const input = document.getElementById("edit").value;
      document.getElementById("result").innerHTML = "";
      Module.ccall("run_lua", 'number', ['string'], [input]);
    }
</script>
<script async type="text/javascript" src="main.js"></script>
</html>
